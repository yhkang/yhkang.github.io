<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>JVM和垃圾回收 - yhkang&#39;s blog</title><meta name="description" content="总结了JVM的内存区域、垃圾回收算法、常用垃圾回收器，期待新的G1和ZGC。"><meta property="og:type" content="article"><meta property="og:title" content="JVM和垃圾回收"><meta property="og:url" content="https://yhkang.me/2019/12/28/JVM%E5%92%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/index.html"><meta property="og:site_name" content="yhkang&#39;s blog"><meta property="og:description" content="总结了JVM的内存区域、垃圾回收算法、常用垃圾回收器，期待新的G1和ZGC。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://yhkang.me/images/og_image.png"><meta property="article:published_time" content="2019-12-28T04:52:46.000Z"><meta property="article:modified_time" content="2020-05-03T18:50:11.742Z"><meta property="article:author" content="yhkang"><meta property="article:tag" content="JVM"><meta property="article:tag" content="GC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://yhkang.me/images/og_image.png"><link rel="icon" href="/images/favicon-32x32-next.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github-gist.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><link rel="stylesheet" href="/css/back-to-top.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-162933326-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-162933326-1")</script><link rel="stylesheet" href="/css/progressbar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><link rel="stylesheet" href="/css/style.css"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicon-32x32-next.png" alt="JVM和垃圾回收" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a> <a class="navbar-item" href="/archives/">Archives</a> <a class="navbar-item" href="/categories/">Categories</a> <a class="navbar-item" href="/tags/">Tags</a> <a class="navbar-item" href="/about/">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://www.github.com/yhkang"><i class="fab fa-github"></i> </a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i> </a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card"><div class="card-content article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>JVM和垃圾回收</h1><div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto"><div class="level-left"><time class="level-item has-text-grey" datetime="2019-12-28T04:52:46.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2019-12-28</time> <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-05-03T18:50:11.742Z"><i class="far fa-calendar-check">&nbsp;</i>2020-05-04</time> <span class="level-item has-text-grey"><i class="far fa-clock"></i>&nbsp; 12 分钟 读完 (大约 1841 个字) </span><span class="level-item has-text-grey" id="busuanzi_container_page_pv"><i class="far fa-eye"></i> <span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><div class="content"><p>总结了JVM的内存区域、垃圾回收算法、常用垃圾回收器，期待新的G1和ZGC。</p><a id="more"></a><h2 id="1-JVM-内存区域"><a href="#1-JVM-内存区域" class="headerlink" title="1. JVM 内存区域"></a>1. JVM 内存区域</h2><h3 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h3><p><img src="/assets/image-20191228120703603.png" alt="image-20191228120703603"></p><!-- more --><h4 id="堆和栈"><a href="#堆和栈" class="headerlink" title="堆和栈"></a>堆和栈</h4><p><img src="/assets/image-20191228120807804.png" alt="image-20191228120807804"></p><h3 id="对象的内存布局和访问定位"><a href="#对象的内存布局和访问定位" class="headerlink" title="对象的内存布局和访问定位"></a>对象的内存布局和访问定位</h3><p><img src="/assets/image-20191228120957339.png" alt="image-20191228120957339"></p><p><img src="/assets/image-20191228121512559.png" alt="image-20191228121512559"></p><ul><li>类加载检查</li><li>分配内存：指针碰撞、空闲列表</li><li>初始化零值</li><li>设置对象头：类的元数据信息、对象的哈希吗、对象的 GC 分代年龄等信息</li><li>执行init方法</li></ul><h4 id="句柄和直接引用"><a href="#句柄和直接引用" class="headerlink" title="句柄和直接引用"></a>句柄和直接引用</h4><p><img src="/assets/image-20191228121105513.png" alt="image-20191228121105513"></p><h3 id="内存参数设置和溢出"><a href="#内存参数设置和溢出" class="headerlink" title="内存参数设置和溢出"></a>内存参数设置和溢出</h3><table><thead><tr><th>溢出类型</th><th>参数设置</th><th>报错信息</th></tr></thead><tbody><tr><td>堆溢出</td><td><code>-Xms</code><br><code>-Xmx</code></td><td><code>java.lang.OutOfMemoryError: GC overhead limit exceeded</code> 不断分配对象<br><code>java.lang.OutOfMemoryError: Java heap space</code> 分配巨型对象</td></tr><tr><td>新生代配置</td><td><code>-Xmn</code><br><code>-XX:NewRatio</code><br><code>-XX:SurvivorRatio</code></td><td></td></tr><tr><td>方法区和运行时常量池溢出</td><td><code>-XX:MetaspaceSize</code><br><code>-XX:MaxMetaspaceSize</code></td><td><code>java.lang.OutOfMemoryError</code></td></tr><tr><td>本地方法栈和虚拟机栈溢出</td><td><code>-Xss</code></td><td><code>java.lang.StackOverflowError</code></td></tr><tr><td>本机直接内存溢出</td><td><code>-XX:MaxDirectMemorySize</code></td><td><code>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Direct buffer memory</code></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h3 id="JDK提供的分析工具"><a href="#JDK提供的分析工具" class="headerlink" title="JDK提供的分析工具"></a>JDK提供的分析工具</h3><table><thead><tr><th></th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>jps</td><td>虚拟机进程状况工具</td><td>jps [-q] [-mlvV]</td></tr><tr><td>jstat</td><td>虚拟机统计信息监视工具</td><td><code>jstat -gc</code><br><code>jstat -gccause</code><br><code>jstat -gcutil &lt;pid&gt;</code><pid></pid></td></tr><tr><td>jinfo</td><td>Java配置信息工具</td><td><code>jinfo -flags &lt;pid&gt;</code><br><code>jinfo -sysprops &lt;pid&gt;</code><br><code>jinfo -flag +PrintGC &lt;pid&gt;</code></td></tr><tr><td>jmap</td><td>Java内存映像工具</td><td><code>jmap -dump:live,format=b,file=heap.bin &lt;pid&gt;</code></td></tr><tr><td><del>jhat</del></td><td>虚拟机堆转储快照分析工具</td><td>分析jmap生成的转储文件</td></tr><tr><td>jstack</td><td>Java堆栈跟踪工具</td><td>线程栈信息，死锁检测，Thread.<em>getAllStackTraces</em>()</td></tr><tr><td>JConsole</td><td>Java监视与管理控制台</td><td></td></tr><tr><td>JVisualVM</td><td>多合一故障处理工具</td><td>比jconsole更强大，支持插件</td></tr><tr><td>jmc</td><td></td><td>飞行记录器，监控数据比jvisualvm更加丰富</td></tr></tbody></table><h2 id="2-垃圾回收和内存分配策略"><a href="#2-垃圾回收和内存分配策略" class="headerlink" title="2. 垃圾回收和内存分配策略"></a>2. 垃圾回收和内存分配策略</h2><ul><li><p>Where回收谁：堆内存、常量池，引用类型</p></li><li><p>When什么时候回收：内存空间不足、</p></li><li><p>How怎么回收：GC算法</p></li></ul><h3 id="判断对象存活"><a href="#判断对象存活" class="headerlink" title="判断对象存活"></a>判断对象存活</h3><table><thead><tr><th></th><th>原理</th><th>优劣</th></tr></thead><tbody><tr><td>引用计数</td><td>记录对象被引用次数，为0时则不可用</td><td>方便简单，但存在相互引用的问题</td></tr><tr><td>可达性分析</td><td>以GC Roots作为起始点开始搜索，搜索路径称为引用链，对象不与引用链相连则此对象不可用</td><td></td></tr></tbody></table><h4 id="GC-Roots"><a href="#GC-Roots" class="headerlink" title="GC Roots"></a>GC Roots</h4><ul><li>虚拟机栈中引用的对象</li><li>本地方法栈中JNI引用的对象</li><li>方法区中类型静态属性引用的对象</li><li>方法区中常量引用的对象</li></ul><h3 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h3><table><thead><tr><th></th><th>示例</th><th>说明和回收时机</th></tr></thead><tbody><tr><td>强引用</td><td><code>Object obj = new Object()</code></td><td></td></tr><tr><td>软引用<br>SoftReference</td><td><code>SoftReference&lt;User&gt; user = new SoftReference&lt;&gt;(new User());</code></td><td>有用非必需的对象，即将OOM之前被回收，用在内存资源紧张、缓存</td></tr><tr><td>弱引用<br>WeakReference</td><td><code>WeakReference&lt;User&gt; user = new WeakReference&lt;&gt;(new User());</code></td><td>稍微有用但非必需，GC发生即被回收，用在缓存、HashMap</td></tr><tr><td>虚引用<br>PhantomReference</td><td>一般使用不上，析构函数finalize不建议使用</td><td>通过虚引用无法拿到对象实例，被回收时收到一个通知</td></tr></tbody></table><h3 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h3><table><thead><tr><th></th><th>工作原理</th><th>优劣</th><th>劣势</th></tr></thead><tbody><tr><td>Mark-Sweep<br>标记清除算法</td><td>先标记出需回收的对象，然后统一回收</td><td>简单</td><td>空间碎片</td></tr><tr><td>Copying<br>复制算法</td><td>内存划分为两部分，将活着的对象复制到另一部分</td><td>空间连续</td><td>浪费一半空间、复制数据</td></tr><tr><td>Mark-Compact<br>标记整理算法</td><td>先标记出需回收的对象，然后把向一端移动</td><td>空间连续</td><td>复制数据</td></tr></tbody></table><h3 id="分代收集"><a href="#分代收集" class="headerlink" title="分代收集"></a>分代收集</h3><p>根据对象存活周期将内存分块，应用不同的收集算法：</p><ul><li>新生代：Eden : Survivor : Survivor = 8 : 1 : 1 复制算法，minor gc</li><li>老年代：标记清除或标记整理，full gc</li></ul><h3 id="垃圾回收器"><a href="#垃圾回收器" class="headerlink" title="垃圾回收器"></a>垃圾回收器</h3><p><img src="/assets/YoungGeneration.png" alt="img"></p><blockquote><p>并行：垃圾收集的多线程的同时进行。</p><p>并发：垃圾收集的多线程和应用的多线程同时进行。</p></blockquote><table><thead><tr><th></th><th>算法</th><th>收集器类型</th><th>特性和适用场景</th></tr></thead><tbody><tr><td>Serial GC</td><td>新生代，复制算法</td><td>单线程</td><td>stop the world，简单高效</td></tr><tr><td>ParNew</td><td>新生代，复制算法</td><td>并行多线程</td><td>关注停顿时间，搭配CMS首选，适合用户交互</td></tr><tr><td>Parallel Scavenge</td><td>新生代，复制算法</td><td>并行多线程</td><td>关注吞吐量，适合后台任务</td></tr><tr><td>Serial Old</td><td>老年代，标记整理算法</td><td>单线程</td><td></td></tr><tr><td>Parallel Old</td><td>老年代，标记整理算法</td><td>并行多线程</td><td>关注吞吐量，搭配Parallel Scavenge</td></tr><tr><td>CMS</td><td>老年代，标记清除算法</td><td>并行并发</td><td>关注停顿时间</td></tr></tbody></table><h4 id="Serial-Serial-Old-1-单CPU"><a href="#Serial-Serial-Old-1-单CPU" class="headerlink" title="Serial + Serial Old  :+1:单CPU"></a>Serial + Serial Old :+1:单CPU</h4><blockquote><p>基于串行回收的垃圾回收器适用于大多数对于暂停时间要求不高的 Client 模式下的 JVM</p></blockquote><p><img src="/assets/3709321-1ee52c298577695f.png" alt="img"></p><h4 id="ParNew-Serial-Old"><a href="#ParNew-Serial-Old" class="headerlink" title="ParNew + Serial Old"></a>ParNew + Serial Old</h4><h4 id="Parallel-Scavenge-Serial-Old"><a href="#Parallel-Scavenge-Serial-Old" class="headerlink" title="Parallel Scavenge + Serial Old"></a>Parallel Scavenge + Serial Old</h4><p><img src="/assets/3709321-13c8878c650dc4f3.png" alt="img"></p><h4 id="Parallel-Scavenge-Parallel-Old-1-高吞吐量"><a href="#Parallel-Scavenge-Parallel-Old-1-高吞吐量" class="headerlink" title="Parallel Scavenge + Parallel Old  :+1:高吞吐量"></a>Parallel Scavenge + Parallel Old :+1:高吞吐量</h4><blockquote><p>程序吞吐量优先的应用场景中，在 Server 模式下内存回收的性能较为不错</p></blockquote><p><img src="/assets/image-20191223000908763.png" alt="image-20191223000908763"></p><h4 id="ParNew-CMS-1-低停顿时间"><a href="#ParNew-CMS-1-低停顿时间" class="headerlink" title="ParNew + CMS  :+1:低停顿时间"></a>ParNew + CMS :+1:低停顿时间</h4><blockquote><p>并发低延迟，吞吐量较低。经过CMS收集的堆会产生空间碎片，会带来堆内存的浪费</p><p>初始标记 -&gt; 并发标记 -&gt; 重新标记 -&gt; 并发清除</p></blockquote><p><img src="/assets/2b525609-ce63-3a42-bf19-b2fbcd42f26c.png" alt="img"></p><h4 id="G1-1-全能型选手​"><a href="#G1-1-全能型选手​" class="headerlink" title="G1  :+1:全能型选手​"></a>G1 :+1:全能型选手​</h4><blockquote><p>基于并行和并发、低延迟以及暂停时间更加可控的区域化分代收集的垃圾回收器</p><p>没有采用传统物理隔离的新生代和老年代的布局方式，仅仅以逻辑上划分为新生代和老年代，选择的将 Java 堆区划分为 2048 个大小相同的独立 Region 块</p></blockquote><p><img src="/assets/image-20191223214538054.png" alt="img"></p><table><thead><tr><th>参数</th><th>新生代</th><th>老年代</th><th>适用场景</th></tr></thead><tbody><tr><td><code>-XX:+UseSerialGC</code></td><td>Serial</td><td>Serial Old</td><td>单CPU</td></tr><tr><td><code>-XX:+UseParNewGC</code></td><td>ParNew</td><td>Serial Old</td><td></td></tr><tr><td><code>-XX:+UseParallelGC</code></td><td>Parallel Scavenge</td><td>Serial Old</td><td></td></tr><tr><td><code>-XX:+UseParallerOldGC</code></td><td>Parallel Scavenge</td><td>Parallel Old</td><td>后台计算，高吞吐量</td></tr><tr><td><code>-XX:+UseConcMarkSweepGC</code></td><td>ParNew</td><td>CMS</td><td>用户交互，低停顿时间</td></tr><tr><td><code>-XX:+UseG1GC</code></td><td></td><td></td><td></td></tr></tbody></table><h3 id="Stop-The-World"><a href="#Stop-The-World" class="headerlink" title="Stop The World"></a>Stop The World</h3><p>暂停用户线程进行垃圾回收的现象。调优的目标就是尽可能的减少STW的时间和次数</p><h3 id="内存分配与回收策略"><a href="#内存分配与回收策略" class="headerlink" title="内存分配与回收策略"></a>内存分配与回收策略</h3><ul><li>对象优先在Eden分配：空间不足则Minor GC</li><li>大对象直接进入老年代：如长字符串或大数组</li><li>长期存活的对象进入老年代：默认15，<code>-XX:MaxTenuringThreshold</code>调整</li><li>动态对象年龄判定：survivor中相同年龄的对象总和大于空间的一半时直接进入老年代</li><li>空间分配担保：survivor空间不足，无法容纳的对象直接进入老年代，老年代的连续空间大于新生代对象的总大小或者历次晋升的平均大小，就进行Minor GC，否则FullGC</li></ul><h3 id="内存泄漏、内存溢出"><a href="#内存泄漏、内存溢出" class="headerlink" title="内存泄漏、内存溢出"></a>内存泄漏、内存溢出</h3><p>OOM</p><ul><li>内存溢出：内存空间不足导致</li><li>内存泄漏：该释放的对象没有释放</li></ul><h3 id="GC调优的原则和步骤"><a href="#GC调优的原则和步骤" class="headerlink" title="GC调优的原则和步骤"></a>GC调优的原则和步骤</h3><ol><li>大部分的java应用不需要调优</li><li>优先改善代码问题</li><li>GC调优时最后的手段<ol><li>选择合适的GC收集器</li><li>选择合适的堆大小</li><li>选择合适的年轻代在堆中的占比</li></ol></li></ol><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol><li>监控GC状态</li><li>分析结果，判断是否要优化<ul><li>Minor GC时间 &lt;50ms, 频率10s</li><li>Full GC时间执行时间 &lt;1s，频率10min</li></ul></li></ol></div><ul class="post-copyright"><li><strong>本文标题：</strong><a href="https://yhkang.me/2019/12/28/JVM%E5%92%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">JVM和垃圾回收</a></li><li><strong>本文作者：</strong><a href="https://yhkang.me">yhkang</a></li><li><strong>本文链接：</strong><a href="https://yhkang.me/2019/12/28/JVM%E5%92%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">https://yhkang.me/2019/12/28/JVM%E5%92%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/</a></li><li><strong>发布时间：</strong>2019-12-28</li><li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul><hr style="height:1px;margin:1rem 0"><div class="level is-size-7 is-uppercase"><div class="level-start"><div class="level-item"><i class="fas fa-tags has-text-grey"></i>&nbsp; <a class="has-link-grey -link" href="/tags/GC/" rel="tag">GC</a>,&nbsp;<a class="has-link-grey -link" href="/tags/JVM/" rel="tag">JVM</a></div></div></div></div></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i> </span><span>微信</span><div class="qrcode"><img src="/images/wechat.jpg" alt="微信"></div></a></div></div></div><div class="card card-transparent"><div class="level post-navigation is-flex-wrap is-mobile"><div class="level-start"><a class="level level-item has-link-grey article-nav-prev" href="/2020/01/05/%E5%88%9D%E8%AF%86IPv6/"><i class="level-item fas fa-chevron-left"></i> <span class="level-item">初识IPv6</span></a></div><div class="level-end"><a class="level level-item has-link-grey article-nav-next" href="/2019/07/01/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95/"><span class="level-item">线上问题定位分析方法</span> <i class="level-item fas fa-chevron-right"></i></a></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5 has-text-weight-normal">评论</h3><script>var disqus_config=function(){this.page.url="https://yhkang.me/2019/12/28/JVM%E5%92%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/",this.page.identifier="2019/12/28/JVM和垃圾回收/"};!function(){var e=document,t=e.createElement("script");t.src="//yhkangme.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen has-order-1 column-left"><div class="card widget"><div class="card-content"><nav class="level" style="margin-bottom:1rem"><div class="level-item has-text-centered" style="flex-shrink:1"><div><figure class="image is-96x96 has-mb-6"><img src="https://www.gravatar.com/avatar/8f5167701c03795f7d5f1c1583e7f7b1?s=96" alt="yhkang"></figure><p class="is-size-4 is-block">yhkang</p><p class="is-size-6 is-block">Life, the universe, and everything</p><p class="is-size-6 is-flex is-flex-center has-text-grey"><i class="fas fa-map-marker-alt has-mr-7"></i> <span>Hangzhou, China</span></p></div></div></nav><nav class="level menu-list is-mobile" style="margin-bottom:1rem"><div class="level-item has-text-centered is-marginless"><a href="/archives/"><p class="heading">文章</p><p class="title has-text-weight-normal">8</p></a></div><div class="level-item has-text-centered is-marginless"><a href="/categories/"><p class="heading">分类</p><p class="title has-text-weight-normal">0</p></a></div><div class="level-item has-text-centered is-marginless"><a href="/tags/"><p class="heading">标签</p><p class="title has-text-weight-normal">8</p></a></div></nav><div class="level"><a class="level-item button is-link is-rounded" href="https://www.github.com/yhkang" target="_blank" rel="noopener"><i class="fab fa-github"></i>&nbsp;&nbsp;关注我</a></div><div class="level is-mobile"><a class="level-item button is-white is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/yhkang"><i class="fab fa-github"></i> </a><a class="level-item button is-white is-marginless" target="_blank" rel="noopener" title="Telegram" href="https://t.me/yhkang"><i class="fab fa-telegram"></i> </a><a class="level-item button is-white is-marginless" target="_blank" rel="noopener" title="E-Mail" href="mailto:yahuakang@gmail.com"><i class="fa fa-envelope"></i></a></div></div></div><div class="card widget column-left is-sticky" id="toc"><div class="card-content" style="max-height:calc(100vh - 22px);overflow:scroll"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#1-JVM-内存区域"><span class="has-mr-6">1</span> <span>1. JVM 内存区域</span></a><ul class="menu-list"><li><a class="is-flex" href="#运行时数据区域"><span class="has-mr-6">1.1</span> <span>运行时数据区域</span></a><ul class="menu-list"><li><a class="is-flex" href="#堆和栈"><span class="has-mr-6">1.1.1</span> <span>堆和栈</span></a></li></ul></li><li><a class="is-flex" href="#对象的内存布局和访问定位"><span class="has-mr-6">1.2</span> <span>对象的内存布局和访问定位</span></a><ul class="menu-list"><li><a class="is-flex" href="#句柄和直接引用"><span class="has-mr-6">1.2.1</span> <span>句柄和直接引用</span></a></li></ul></li><li><a class="is-flex" href="#内存参数设置和溢出"><span class="has-mr-6">1.3</span> <span>内存参数设置和溢出</span></a></li><li><a class="is-flex" href="#JDK提供的分析工具"><span class="has-mr-6">1.4</span> <span>JDK提供的分析工具</span></a></li></ul></li><li><a class="is-flex" href="#2-垃圾回收和内存分配策略"><span class="has-mr-6">2</span> <span>2. 垃圾回收和内存分配策略</span></a><ul class="menu-list"><li><a class="is-flex" href="#判断对象存活"><span class="has-mr-6">2.1</span> <span>判断对象存活</span></a><ul class="menu-list"><li><a class="is-flex" href="#GC-Roots"><span class="has-mr-6">2.1.1</span> <span>GC Roots</span></a></li></ul></li><li><a class="is-flex" href="#引用类型"><span class="has-mr-6">2.2</span> <span>引用类型</span></a></li><li><a class="is-flex" href="#垃圾回收算法"><span class="has-mr-6">2.3</span> <span>垃圾回收算法</span></a></li><li><a class="is-flex" href="#分代收集"><span class="has-mr-6">2.4</span> <span>分代收集</span></a></li><li><a class="is-flex" href="#垃圾回收器"><span class="has-mr-6">2.5</span> <span>垃圾回收器</span></a><ul class="menu-list"><li><a class="is-flex" href="#Serial-Serial-Old-1-单CPU"><span class="has-mr-6">2.5.1</span> <span>Serial + Serial Old :+1:单CPU</span></a></li><li><a class="is-flex" href="#ParNew-Serial-Old"><span class="has-mr-6">2.5.2</span> <span>ParNew + Serial Old</span></a></li><li><a class="is-flex" href="#Parallel-Scavenge-Serial-Old"><span class="has-mr-6">2.5.3</span> <span>Parallel Scavenge + Serial Old</span></a></li><li><a class="is-flex" href="#Parallel-Scavenge-Parallel-Old-1-高吞吐量"><span class="has-mr-6">2.5.4</span> <span>Parallel Scavenge + Parallel Old :+1:高吞吐量</span></a></li><li><a class="is-flex" href="#ParNew-CMS-1-低停顿时间"><span class="has-mr-6">2.5.5</span> <span>ParNew + CMS :+1:低停顿时间</span></a></li><li><a class="is-flex" href="#G1-1-全能型选手​"><span class="has-mr-6">2.5.6</span> <span>G1 :+1:全能型选手​</span></a></li></ul></li><li><a class="is-flex" href="#Stop-The-World"><span class="has-mr-6">2.6</span> <span>Stop The World</span></a></li><li><a class="is-flex" href="#内存分配与回收策略"><span class="has-mr-6">2.7</span> <span>内存分配与回收策略</span></a></li><li><a class="is-flex" href="#内存泄漏、内存溢出"><span class="has-mr-6">2.8</span> <span>内存泄漏、内存溢出</span></a></li><li><a class="is-flex" href="#GC调优的原则和步骤"><span class="has-mr-6">2.9</span> <span>GC调优的原则和步骤</span></a><ul class="menu-list"><li><a class="is-flex" href="#步骤"><span class="has-mr-6">2.9.1</span> <span>步骤</span></a></li></ul></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start has-text-centered-mobile"><a class="footer-logo is-block has-mb-6" href="/"><img src="/images/favicon-32x32-next.png" alt="JVM和垃圾回收" height="28"></a><p class="is-size-7">&copy; 2020 yhkang&nbsp; Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle"><p class="control"><a class="button is-white is-large" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons"></i>&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;<i class="fab fa-creative-commons-nc"></i>&nbsp;<i class="fab fa-creative-commons-sa"></i>&nbsp;</a></p><p class="control"><a class="button is-white is-large" target="_blank" rel="noopener" title="GitHub" href="https://www.github.com/yhkang"><i class="fab fa-github"></i>&nbsp;</a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={site:{url:"https://yhkang.me",external_link:{enable:!0,exclude:[]}},article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script src="/js/gallery.js" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})})</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script>document.addEventListener("DOMContentLoaded",function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!1},SVG:{matchFontHeight:!1},CommonHTML:{matchFontHeight:!1},tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})})</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><script src="/js/main.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js" defer></script><link rel="stylesheet" href="/css/search.css"><link rel="stylesheet" href="/css/insight.css"></body></html>